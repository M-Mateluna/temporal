// ----- controlador.js -----

// Instancia única del lightbox de máscara
let UI = null;

// Wrapper de MessageBox (igual que antes)
let MSGBOX = {
  ventana: undefined,
  initialize() {
    this.ventana = new IU_MSGBOX();
  },
  Abrir(conf) {
    this.ventana.titulo    = conf.titulo || 'Aviso';
    this.ventana.texto     = '<center>' + (conf.texto || '') + '</center>';
    this.ventana.botonera  = (conf.botonera != null) ? conf.botonera : 1;
    this.ventana.titulocss = conf.titulocss || 'tituloazulmsgbox';
    this.ventana.conCerrar = (conf.conCerrar != undefined) ? conf.conCerrar : this.ventana.conCerrar;
    this.ventana.fnretorno = conf.fnretorno || 'retMsgOnlyClose';
    this.ventana.url       = posicion; // base del sistema
    this.ventana.top       = '25%';
    this.ventana.objeto    = conf.objeto || {};
    this.ventana.Messagebox();
    this.ventana.zzIndex   = 2;
  }
};
MSGBOX.initialize();

// Función que usa IU para cerrar (la pasamos por nombre)
function CerrarLB() {
  if (UI) UI.HideInfo();
}

// Abre el selector (PRIMER lightbox)
function abrirSelectorBancos() {
  if (!UI) UI = new IU();
  // ShowInfoWidget(iframe, alto, ancho, functionName, top?)
  UI.ShowInfoWidget('lb_bancos.php', 480, 900, 'CerrarLB', 120);
}

// Abre el detalle (SEGUNDO lightbox) mostrando el nombre del banco
function abrirLightboxBanco(nombreBanco) {
  if (!UI) UI = new IU();
  // Reutilizamos el mismo overlay y reemplazamos el contenido con el segundo LB
  UI.ShowInfoWidget('lb_detalle.php?nombre=' + encodeURIComponent(nombreBanco), 480, 900, 'CerrarLB', 120);
}

// MSGBOX – callback de 1 botón
function retMsgOnlyClose() {
  MSGBOX.ventana.HideInfo();
}

// Bind del botón principal
document.addEventListener('DOMContentLoaded', function () {
  const b = document.getElementById('btnAbrirLB');
  if (b) b.onclick = abrirSelectorBancos;
});

// Exponer para que el iframe (lb_bancos.js) pueda llamar al padre
window.abrirLightboxBanco = abrirLightboxBanco;
window.MSGBOX = MSGBOX;
window.retMsgOnlyClose = retMsgOnlyClose;
window.CerrarLB = CerrarLB;
