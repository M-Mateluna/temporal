// Extrae "YYYY-MM-DDTHH:MM" de cadenas como "YYYY-MM-DD HH:MM:SS(.fffff)"
function normalizaFechaHoraDB(a) {
  if (!a) return '';
  const m = String(a).match(/^(\d{4}-\d{2}-\d{2})[ T](\d{2}):(\d{2})/);
  return m ? (m[1] + 'T' + m[2] + ':' + m[3]) : '';
}



clienteproveedor.afterEvent = function(self) {
  // --- normaliza datetime-local SIN poner "hoy" ---
  if (self.elementos.fechahora) {
    const raw = self.elementos.fechahora.value;
    const fix = normalizaFechaHoraDB(raw);
    if (fix) self.elementos.fechahora.value = fix;
  }

  if (self.ultimoEvento === "onkeypress") {
    self.elementos.idusuario.disabled = true;
    self.elementos.giro.disabled = true;
    MSGBOX.Abrir({
      titulo: 'AfterEvent',
      texto: 'Se ha desencadenado el evento <b>Onkeypress</b>, bloqueando <b>idusuario</b> y <b>giro</b>.',
      botonera: 1,
      fnretorno: 'retGenerico',
      conCerrar: false
    });
  } else {
    self.elementos.rut.disabled = true;
    self.elementos.giro.disabled = true;
    self.elementos.idusuario.disabled = true;
    MSGBOX.Abrir({
      titulo: 'AfterEvent',
      texto: 'Se ha desencadenado el evento <b>Onclick</b>, bloqueando <b>rut</b>, <b>giro</b> y <b>idusuario</b>.',
      botonera: 1,
      fnretorno: 'retGenerico',
      conCerrar: false
    });
  }

  setTimeout(cerrarLightbox, 0);
};
