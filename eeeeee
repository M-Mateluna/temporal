<?php
// Resolver $POSICION
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
$titulo_formulario = "Termino Contrato";
require_once($POSICION."formHeader.php");

/* ---- Fechas: hoy ± 1 mes ---- */
$hoy = new DateTime('today');
$min = (clone $hoy)->modify('-1 month')->format('d-m-Y');
$max = (clone $hoy)->modify('+1 month')->format('d-m-Y');
$hoyStr = $hoy->format('d-m-Y');
?>

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Termino Contrato</title>
  <link rel="stylesheet" href="<?=$POSICION?>css/nuevoestilo.css?v=1.8">
  <style>
    .lb-box { 
      min-width: 560px; 
      background: #f1f1f1; 
      padding: 24px; 
      font-family: Verdana, Arial, sans-serif;
    }
    .row { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin: 14px 0; 
    }
    .lbl { 
      min-width: 220px; 
      font-weight: bold; 
      font-size: 12px; 
    }
    .center { text-align: center; }
  </style>
</head>

<body>
  <div class="FORMULARIONECSS lb-box">
    <div class="row">
      <div class="lbl">Ingrese Fecha de Término:</div>

      <?php
      // Configuración del componente calendario
      $nom_fech              = "fecha_termino";
      $val_fech              = $hoyStr;          // valor inicial = hoy
      $cnf_to                = $min;             // fecha mínima permitida
      $cnf_hasta             = $max;             // fecha máxima permitida
      $nom_fech_disabled     = "F";              // habilitado
      $btn_clear_fech        = "btnClear";       // botón borrar
      $btn_clear_fech_disabled = "F";            // botón borrar activo
      $label_input           = "";               // sin label adicional
      $btn_borrar_in         = false;
      $classAdicional        = "inputFecha";
      $classPrincipal        = "form-control";

      include($POSICION."componente/calendario/componente_fechadd.php");
      ?>
    </div>

    <div class="row center">
      <button type="button" id="btnGuardar" style="padding:5px 15px;">Guardar</button>
    </div>
  </div>

  <!-- Componentes requeridos del entorno Desis -->
  <script src="<?=$POSICION?>componente/database/class.php?v=<?=rand()?>"></script>
  <script src="<?=$POSICION?>componente/messagebox/class.php?v=<?=rand()?>"></script>
  <script src="<?=$POSICION?>componente/mascara/lightbox-iframe.js?v=<?=rand()?>"></script>
  <script src="<?=$POSICION?>componente/mascara/iu.js?v=<?=rand()?>"></script>

  <script>
    const btnGuardar = document.getElementById('btnGuardar');
    const inputFecha = document.getElementById('fecha_termino');

    // Al guardar: enviar valor al padre y cerrar
    btnGuardar.addEventListener('click', () => {
      const val = inputFecha.value;
      if (window.parent) {
        window.parent.postMessage({ type: 'set_fecha', value: val }, '*');
      }
      if (window.parent && typeof window.parent.OcultarVentana === 'function') {
        window.parent.OcultarVentana();
      }
    });
  </script>
</body>
</html>
