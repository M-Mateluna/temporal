<?php
// Resolver $POSICION hasta la raíz
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
require($POSICION."formHeader.php");
?>
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Ejercicio Propuesto - Calendario</title>

  <link rel="stylesheet" href="<?=$POSICION?>css/nuevoestilo.css?v=1.8">
  <style>
    .wrap{max-width:560px;margin:18px auto;background:#f1f1f1;padding:14px}
    .fila{display:flex;gap:8px;align-items:center}
    .btn{height:30px;padding:0 12px;border:1px solid #6c757d;background:#000;color:#fff;border-radius:6px;cursor:pointer}
    #fecha{width:260px;background:#eee}
  </style>
</head>
<body>

<div class="wrap FORMULARIONECSS">
  <fieldset>
    <legend class="legends">Calendario</legend>
    <label for="fecha">Fecha</label>
    <div class="fila">
      <input type="text" id="fecha" placeholder="Ej: 28-02-2024" disabled>
      <button type="button" id="btnAbrir" class="btn">Ingresa fecha</button>
    </div>
  </fieldset>
</div>

<!-- Lightbox & Messagebox -->
<script src="<?=$POSICION?>componente/mascara/lightbox-iframe.js"></script>
<script src="<?=$POSICION?>componente/mascara/iu.js"></script>
<script src="<?=$POSICION?>componente/messagebox/class.php?v=1"></script>

<script>
// ---------- util: abrir/cerrar lightbox de forma tolerante ----------
function abrirLightbox(url, titulo, ancho, alto){
  try {
    if (window.Accion && Accion.ventana && typeof Accion.ventana.AbrirVentana === 'function') {
      Accion.ventana.AbrirVentana(url, titulo || '', ancho||650, alto||350);
      return;
    }
    if (typeof AbrirVentana === 'function') {
      AbrirVentana(url, titulo || '', ancho||650, alto||350);
      return;
    }
  } catch(e){}
  // fallback
  window.open(url, '_lb', 'width='+(ancho||650)+',height='+(alto||350));
}

function cerrarLightbox(){
  try {
    if (window.parent && typeof window.parent.OcultarVentana === 'function'){ window.parent.OcultarVentana(); return; }
    if (typeof OcultarVentana === 'function'){ OcultarVentana(); return; }
  } catch(e){}
  // sin API: nada que cerrar (si abrió como window.open, se cierra desde adentro)
}

// ---------- abrir lightbox al pulsar "Ingresa fecha" ----------
document.getElementById('btnAbrir').onclick = function(){
  // paso el rango por query si lo necesitaras; aquí no es necesario
  abrirLightbox('lb_fecha.php', 'Termino Contrato', 650, 360);
};

// ---------- recibir la fecha desde el lightbox ----------
window.addEventListener('message', function(ev){
  if (!ev || !ev.data) return;
  if (ev.data.type === 'set_fecha'){
    var el = document.getElementById('fecha');
    if (el) el.value = ev.data.value || '';
    cerrarLightbox();
  }
}, false);
</script>

</body>
</html>
