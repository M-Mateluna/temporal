<?php
// Resolver $POSICION hasta la raíz (metodología DESIS)
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
require($POSICION."formHeader.php");
?>
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Ejercicio Propuesto - Calendario</title>

  <!-- Nuevo estilo -->
  <link rel="stylesheet" href="<?=$POSICION?>css/nuevoestilo.css?v=1.8">

  <style>
    .wrap { max-width: 560px; margin: 18px auto; background:#f1f1f1; padding:14px; }
    .fila { display:flex; gap:8px; align-items:center; }
    #fecha { width:260px; background:#eee; }
    .btn-negro { height:30px; padding:0 14px; border:1px solid #000; background:#000; color:#fff; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>

<div class="wrap FORMULARIONECSS">
  <fieldset>
    <legend class="legends">Calendario</legend>

    <label for="fecha">Fecha</label>
    <div class="fila">
      <input type="text" id="fecha" placeholder="Ej: 28-02-2024" disabled>
      <button type="button" id="btnAbrir" class="btn-negro">Ingresa fecha</button>
    </div>
  </fieldset>
</div>

<!-- (opcional) librerías de lightbox que usaremos cuando creemos lb_fecha.php -->
<script src="<?=$POSICION?>componente/mascara/lightbox-iframe.js"></script>
<script src="<?=$POSICION?>componente/mascara/iu.js"></script>

<script>
// Abrir lightbox (lo implementaremos en el siguiente paso con lb_fecha.php)
function abrirLightbox(url, titulo, ancho, alto){
  try {
    if (window.Accion && Accion.ventana && typeof Accion.ventana.AbrirVentana === 'function') {
      Accion.ventana.AbrirVentana(url, titulo||'', ancho||650, alto||360);
      return;
    }
    if (typeof AbrirVentana === 'function') {
      AbrirVentana(url, titulo||'', ancho||650, alto||360);
      return;
    }
  } catch(e){}
  // Fallback si no hay APIs de lightbox disponibles (abre una ventana nueva)
  window.open(url, '_lb', 'width='+(ancho||650)+',height='+(alto||360));
}

document.getElementById('btnAbrir').onclick = function(){
  // Crearemos este archivo en el siguiente paso
  abrirLightbox('lb_fecha.php', 'Termino Contrato', 650, 360);
};

// Receptor del valor (lo enviará lb_fecha.php vía postMessage)
window.addEventListener('message', function(ev){
  if (!ev || !ev.data) return;
  if (ev.data.type === 'set_fecha'){
    var el = document.getElementById('fecha');
    if (el) el.value = ev.data.value || '';
  }
}, false);
</script>

</body>
</html>
