<?php
// Ubicar raíz del proyecto y cargar cabeceras estándar
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
require_once($POSICION."conexion.php");
require_once($POSICION."formHeader.php");
?>


<!-- Importaciones requeridas -->
<script type="text/javascript" src="<?=$POSICION;?>componente/mascara/lightbox-iframe.js?v=<?=rand();?>"></script>
<script type="text/javascript" src="<?=$POSICION;?>componente/mascara/iu.js?v=<?=rand();?>"></script>
<script type="text/javascript" src="<?=$POSICION;?>componente/messagebox/class.php?v=1"></script>


<!-- Controlador local de la demo -->
<script>window.POSICION = '<?=$POSICION?>';</script>
<script type="text/javascript" src="controlador.js?v=<?=rand();?>"></script>


<div style="max-width:900px;margin:2rem auto;padding:1.5rem;border:1px solid #ccc;border-radius:8px;">
<h2 style="margin-top:0;">Demo: Calendario + Lightbox + MessageBox</h2>
<p>Ejemplo mínimo con los tres componentes estándar de Desis.</p>


<!-- FILTROS: Fecha Desde / Fecha Hasta -->
<fieldset style="border:1px solid #999;border-radius:6px;padding:1rem;">
<legend>Rango de Fechas</legend>


<!-- Fecha Desde -->
<div style="padding:0.8rem 0;">
<?php
$label_input = 'Fecha Desde';
$nom_fech = 'fechadesde';
$nom_fech_disabled = 'F';
$val_fech = '';
$btn_clear_fech = 'fecha_desde_btn';
$btn_clear_fech_disabled = 'F';
$classPrincipal = 'FORMULARIONECSS';
$classAdicional = '';
$btn_borrar_in = true; // botón borrar dentro del input
$fech_style = 'width:17em;height:21px;';
// (Opcional) límites permitidos
$cnf_to = '';
$cnf_hasta = '';
include $POSICION."componente/calendario/componente_fechadd.php";
?>
</div>


<!-- Fecha Hasta -->
<div style="padding:0.8rem 0;">
<?php
$label_input = 'Fecha Hasta';
$nom_fech = 'fechahasta';
$nom_fech_disabled = 'F';
$val_fech = '';
$btn_clear_fech = 'fecha_hasta_btn';
$btn_clear_fech_disabled = 'F';
$classPrincipal = 'FORMULARIONECSS';
$classAdicional = '';
$btn_borrar_in = true;
$fech_style = 'width:17em;height:21px;';
$cnf_to = '';
$cnf_hasta = '';
include $POSICION."componente/calendario/componente_fechadd.php";
?>
</div>
</fieldset>


<!-- ACCIONES -->
<div style="display:flex;gap:0.75rem;margin-top:1rem;">
<button type="button" onclick="Ajuste.abrirLightboxPrincipal()" style="height:32px;padding:0 14px;">Abrir Módulo (Lightbox)</button>
<button type="button" onclick="acciones.confirmarFiltros()" style="height:32px;padding:0 14px;">Confirmar Filtros (MessageBox)</button>
</div>
</div>


<?php require_once($POSICION."formFoot.php"); ?>




// Crear estructura base de Lightbox al cargar la página
addLightboxMarkup();


// Objeto para gestionar Lightbox principal + anidados
var Ajuste = {
ventana: typeof IU,
initialize: function () {
this.ventana = new IU();
},
abrirLightboxPrincipal: function () {
// Abre contenido.php en un lightbox con callback al cerrar
this.ventana.ShowInfoWidget("contenido.php", 700, 900, 'OcultarVentana');
}
};
Ajuste.initialize();


// Callback estándar para cerrar
function OcultarVentana() {
Ajuste.ventana.HideInfo();
}


// Implementación de MessageBox (patrón escalable)
var MSGBOX = {
ventana: typeof IU_MSGBOX,
initialize: function(){ this.ventana = new IU_MSGBOX(); },
Abrir: function(conf){
this.ventana.titulo = conf.titulo || 'Aviso';
this.ventana.texto = '<center>' + (conf.texto || '') + '</center>';
this.ventana.botonera = conf.botonera || 3; // por defecto Sí/No
this.ventana.conCerrar = (conf.conCerrar !== undefined) ? conf.conCerrar : this.ventana.conCerrar;
this.ventana.fnretorno = conf.fnretorno || 'MSGBOX.fnretorno';
this.ventana.objeto = conf.objeto || {};
this.ventana.url = window.POSICION;
this.ventana.Messagebox();
},
fnretorno: function(resp){ /* opcional */ }
};
MSGBOX.initialize();


// Acciones de la vista principal
var acciones = {
confirmarFiltros: function(){
var desde = document.getElementById('fechadesde') ? document.getElementById('fechadesde').value : '';
var hasta = document.getElementById('fechahasta') ? document.getElementById('fechahasta').value : '';


// Mensaje de confirmación
MSGBOX.Abrir({
titulo: 'Confirmación',
texto: '¿Aplicar el rango de fechas seleccionado?<br><small>Desde: ' + (desde||'-') + ' / Hasta: ' + (hasta||'-') + '</small>',
botonera: 3, // Sí / No
fnretorno: 'acciones._confirmarFiltrosRetorno',
conCerrar: false,
objeto: { desde: desde, hasta: hasta }
});
},
_confirmarFiltrosRetorno: function(resp){
if (resp === 'S') {
// Aquí iría la lógica real (AJAX/DB). Para demo, solo cierre.
// Ej.: ajax('aplicarFiltros', 'desde=...&hasta=...', onOk, onErr)
}
MSGBOX.ventana.HideInfo();
}
};




<?php
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
$titulo_formulario = "Contenido en Lightbox";
require_once($POSICION."formHeader.php");
?>


<div style="padding:1rem 1.25rem;">
<h3 style="margin-top:0;">Lightbox Principal</h3>
<p>Este contenido se abrió con <code>ShowInfoWidget</code>. Desde aquí podemos abrir otro lightbox dentro de este (anidado) usando <code>ShowInfoDentro</code>.</p>


<div style="display:flex;gap:0.75rem;">
<button type="button" onclick="showIframeHijo()" style="height:32px;padding:0 14px;">Elegir Banco (Lightbox dentro)</button>
<button type="button" onclick="showMsgLocal()" style="height:32px;padding:0 14px;">Probar MessageBox (Hijo)</button>
</div>
</div>


<?php require_once($POSICION."formFoot.php"); ?>


<!-- Importaciones requeridas del hijo -->
<script type="text/javascript" src="<?=$POSICION;?>componente/mascara/lightbox-iframe.js?v=<?=rand();?>"></script>
<script type="text/javascript" src="<?=$POSICION;?>componente/mascara/iu.js?v=<?=rand();?>"></script>
<script type="text/javascript" src="<?=$POSICION;?>componente/messagebox/class.php?v=1"></script>


<script>
// Cada documento que usa Lightbox debe tener su propio IU
var Ajuste = {
ventana: typeof IU,
initialize: function(){ this.ventana = new IU(); },
abrirHijo: function(){
// Abre un lightbox dentro del actual
this.ventana.ShowInfoDentro('bancos.php', '290px', '585px', 'Ajuste.ventana.HideInfo');
}
};
Ajuste.initialize();


function showIframeHijo(){
addLightboxMarkup();
Ajuste.abrirHijo();
}


// MessageBox de ejemplo local (en hijo)
var MSGBOX = {
ventana: typeof IU_MSGBOX,
initialize: function(){ this.ventana = new IU_MSGBOX(); },
Abrir: function(conf){
this.ventana.titulo = conf.titulo || 'Aviso';
this.ventana.texto = '<center>' + (conf.texto || '') + '</center>';
this.ventana.botonera = conf.botonera || 1; // Aceptar
this.ventana.fnretorno = conf.fnretorno || 'MSGBOX.fnretorno';
this.ventana.url = '<?=$POSICION?>';
this.ventana.Messagebox();
},
fnretorno: function(resp){ /* opcional */ }
};
MSGBOX.initialize();


function showMsgLocal(){
MSGBOX.Abrir({ titulo: 'Información', texto: 'Hola desde el lightbox hijo', botonera: 1 });
}
</script>



<?php
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
$titulo_formulario = "Banco";
require_once($POSICION."formHeader.php");
?>


<div style="padding:1rem 1.25rem;">
<h3 style="margin-top:0;">Seleccione un Banco</h3>
<p>Este es el lightbox anidado (abierto con <code>ShowInfoDentro</code>).</p>


<label for="banco">Banco:</label>
<select id="banco" style="height:24px;">
<option value="">Seleccione...</option>
<option>Banco Estado</option>
<option>Santander</option>
<option>BCI</option>
<option>Scotiabank</option>
</select>


<div style="margin-top:0.75rem;display:flex;gap:0.5rem;">
<button type="button" onclick="confirmarBanco()" style="height:28px;padding:0 12px;">Aceptar</button>
<button type="button" onclick="cerrar()" style="height:28px;padding:0 12px;">Cerrar</button>
</div>
</div>


<?php require_once($POSICION."formFoot.php"); ?>


<script type="text/javascript" src="<?=$POSICION;?>componente/messagebox/class.php?v=1"></script>
<script>
var MSGBOX = {
ventana: typeof IU_MSGBOX,
initialize: function(){ this.ventana = new IU_MSGBOX(); },
Abrir: function(conf){
this.ventana.titulo = conf.titulo || 'Aviso';
this.ventana.texto = '<center>' + (conf.texto || '') + '</center>';
this.ventana.botonera = conf.botonera || 1;
this.ventana.fnretorno = conf.fnretorno || 'MSGBOX.fnretorno';
this.ventana.url = '<?=$POSICION?>';
this.ventana.Messagebox();
},
fnretorno: function(resp){ /* opcional */ }
};
MSGBOX.initialize();


function confirmarBanco(){
var sel = document.getElementById('banco').value || '-';
MSGBOX.Abrir({
titulo: 'Confirmación',
texto: 'Usted ha seleccionado: <b>' + sel + '</b>',
botonera: 1,
fnretorno: 'cerrar'
});
}


function cerrar(){
if (parent && parent.Ajuste && parent.Ajuste.ventana) {
parent.Ajuste.ventana.HideInfo(); // Cierra el lightbox hijo desde el padre
} else {
window.close && window.close();
}
}
</script>
