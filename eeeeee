<?php
while (!file_exists($POSICION . "conexion.php")) { $POSICION .= "../"; }
require_once($POSICION . "formHeader.php");
?>
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Ejercicio Calendario (Lightbox)</title>

  <link rel="stylesheet" href="<?=$POSICION?>css/nuevoestilo.css?v=1.8">
  <style>
    .contenedor { text-align:center; padding:20px; background:#f1f1f1; border-radius:10px; width:420px; margin:60px auto; }
    label{ display:block; margin-bottom:6px; text-align:left; }
    input[type="text"]{ width:100%; height:26px; border-radius:5px; border:1px solid #999; padding:0 8px; background:#eee; }
    button{ height:30px; padding:0 14px; border-radius:5px; border:1px solid #777; background:#000; color:#fff; cursor:pointer; font-weight:bold; margin-top:10px; }
    button:hover{ background:#111; }
  </style>
</head>
<body>

  <div class="FORMULARIONECSS contenedor">
    <fieldset>
      <legend class="legends">Selección de Fecha</legend>
      <label for="fecha">Fecha</label>
      <input type="text" id="fecha" placeholder="Ej: 28-02-2024" disabled>
      <br>
      <button type="button" id="btnAbrir">Ingresa fecha</button>
    </fieldset>
  </div>

  <!-- Lightbox DESIS -->
  <script src="<?=$POSICION?>componente/mascara/lightbox-iframe.js?v=<?=rand()?>"></script>
  <script src="<?=$POSICION?>componente/mascara/iu.js?v=<?=rand()?>"></script>

  <script>
    // 1) Markup + IU (tal como en la wiki)
    addLightboxMarkup();
    var Ajuste = { ventana: typeof IU, initialize: function(){ this.ventana = new IU(); } };
    Ajuste.initialize();

    // 2) URL robusta a lb_fecha.php en la MISMA carpeta que este index
    //    (evita 404/500 por rutas relativas raras y evita caché)
    function urlLbFecha(){
      var base = location.pathname.replace(/[^\/]+$/, ''); // carpeta del index
      return base + 'lb_fecha.php?ts=' + Date.now();
    }

    function abrirCalendario(){
      var url = urlLbFecha();

      // Intenta API con título; si no existe, usa la clásica
      if (typeof Ajuste.ventana.ShowInfoWidgetTitulo === 'function') {
        Ajuste.ventana.ShowInfoWidgetTitulo("Termino Contrato", url, 360, 650, "OcultarVentana");
      } else {
        Ajuste.ventana.ShowInfoWidget(url, 360, 650, "OcultarVentana");
      }
    }

    function OcultarVentana(){ Ajuste.ventana.HideInfo(); }

    document.getElementById("btnAbrir").onclick = abrirCalendario;

    // Recibir la fecha del lightbox
    window.addEventListener('message', function (ev) {
      if (ev && ev.data && ev.data.type === 'set_fecha') {
        var el = document.getElementById('fecha');
        if (el) el.value = ev.data.value || '';
        OcultarVentana();
      }
    }, false);
  </script>
</body>
</html>
