(function(){
  // Este JS corre dentro del iframe de lb_bancos.php
  var BD = new BASE();
  BD.commandFile = 'command.php';

  function cargarBancos(){
    var RS = BD.send('cmd=listar');
    if (!RS || (RS.error && RS.error.trim() !== '')) { return; }

    var n = Number(RS.numrows || 0);
    var sel = document.getElementById('selBanco');
    sel.innerHTML = ''; // limpio y agrego opci√≥n en blanco
    var opt0 = document.createElement('option');
    opt0.value = '';
    opt0.text  = 'Seleccione...';
    sel.appendChild(opt0);

    for (var i=0;i<n;i++){
      var id  = BD.getField(RS,'idbanco', i);
      var nom = BD.getField(RS,'nombre',  i) || '';
      var opt = document.createElement('option');
      opt.value = id;
      opt.text  = nom;
      sel.appendChild(opt);
    }
  }

  function irAPagina(){
    var sel = document.getElementById('selBanco');
    var id  = sel.value;
    var nom = sel.options[sel.selectedIndex] ? sel.options[sel.selectedIndex].text : '';

    if (String(id).trim() === '') {
      try {
        top.MSGBOX.Abrir({
          titulocss: 'titulorojomsgbox',
          titulo: 'Advertencia',
          texto: 'Debe seleccionar un banco, para abrir el lightbox.',
          botonera: 1,
          fnretorno: 'top.retMsgOnlyClose',
          conCerrar: true
        });
      } catch(e) { alert('Debe seleccionar un banco.'); }
      return;
    }

    try { top.abrirLightboxBanco(nom); } catch(e) {}
  }

  document.addEventListener('DOMContentLoaded', function(){
    cargarBancos();
    var btn = document.getElementById('btnGo');
    if (btn) btn.onclick = irAPagina;
  });
})();
