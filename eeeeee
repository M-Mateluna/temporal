// controlador.js — MessageBox (IU_MSGBOX) + 6 botones + select de moneda
// Requisitos del componente: <div id="MSGBOX_"></div> y <div id="MSGBOX_OL_"></div> en el HTML.

let MSGBOX = {
  ventana: undefined,

  initialize: function () {
    this.ventana = new IU_MSGBOX();
  },

  Abrir: function (conf) {
    // Título y texto
    this.ventana.titulo = conf.titulo || 'Aviso';
    let texto = conf.texto || '';
    this.ventana.texto = '<center>' + texto + '</center>';

    // Botonera:
    // 1: Aceptar
    // 2: Aceptar/Cancelar
    // 3: Sí/No
    // 4: Sí/No/Cancelar
    // 5: Imprimir/Cancelar
    // 6: Aceptar/Cancelar/Anular
    this.ventana.botonera = (conf.botonera != null) ? String(conf.botonera) : '1';

    // Estilo del título
    this.ventana.titulocss = conf.titulocss || 'tituloazulmsgbox';

    // Comportamiento de cierre (X)
    this.ventana.conCerrar = (conf.conCerrar !== undefined) ? conf.conCerrar : this.ventana.conCerrar;

    // Callback (nombre de función global que recibirá la letra de retorno)
    this.ventana.fnretorno = conf.fnretorno || 'MSGBOX.fnretorno';

    // Objeto auxiliar para pasar datos entre llamadas
    this.ventana.objeto = conf.objeto || {};

    // Prefijo de URL (usa la global POSICION definida en el componente)
    // El propio componente hará: this.url + 'componente/messagebox/messagebox.php?...'
    this.ventana.url = (typeof POSICION !== 'undefined') ? POSICION : '';

    // Mostrar
    this.ventana.Messagebox();
  },

  // Callback por defecto (cierra)
  fnretorno: function (resp) {
    MSGBOX.ventana.HideInfo();
  }
};

MSGBOX.initialize();

// ====== Referencias a la UI ======
let btnSoloAceptar            = document.getElementById('btnSoloAceptar');
let btnAceptarCancelar        = document.getElementById('btnAceptarCancelar');
let btnSiNo                   = document.getElementById('btnSiNo');
let btnSiNoCancelar           = document.getElementById('btnSiNoCancelar');
let btnImprimirCancelar       = document.getElementById('btnImprimirCancelar');
let btnAceptarCancelarAnular  = document.getElementById('btnAceptarCancelarAnular');
let selMoneda                 = document.getElementById('selMoneda');

// ====== Botón 1: Solo Aceptar ======
btnSoloAceptar.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulorojomsgbox',
    titulo: 'Información',
    texto: 'Este MessageBox solo muestra el botón Aceptar.',
    botonera: 1
  });
});

// ====== Botón 2: Aceptar / Cancelar ======
btnAceptarCancelar.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulonaranjamsgbox',
    titulo: 'Confirmación',
    texto: '¿Desea continuar con la acción?',
    botonera: 2
  });
});

// ====== Botón 3: Sí / No ======
btnSiNo.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulorojomsgbox',
    titulo: 'Pregunta',
    texto: '¿Confirma su selección?',
    botonera: 3
  });
});

// ====== Botón 4: Sí / No / Cancelar ======
btnSiNoCancelar.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulonaranjamsgbox',
    titulo: 'Guardar cambios',
    texto: '¿Deseas guardar antes de salir?',
    botonera: 4
  });
});

// ====== Botón 5: Imprimir / Cancelar ======
btnImprimirCancelar.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulorojomsgbox',
    titulo: 'Impresión',
    texto: '¿Desea imprimir el documento actual?',
    botonera: 5,
    fnretorno: 'fnRetornoImprimir'
  });
});

// ====== Botón 6: Aceptar / Cancelar / Anular ======
btnAceptarCancelarAnular.addEventListener('click', function () {
  MSGBOX.Abrir({
    titulocss: 'titulonaranjamsgbox',
    titulo: 'Estado de operación',
    texto: 'Selecciona el estado de la operación.',
    botonera: 6
  });
});

// ====== Select de moneda: flujo Sí/No -> Aceptar ======
selMoneda.addEventListener('change', function () {
  let moneda = selMoneda.value;
  if (!moneda) return;

  // 1er MessageBox: confirmación
  MSGBOX.Abrir({
    titulocss: 'titulorojomsgbox',
    titulo: 'Moneda',
    texto: '¿Desea mostrar el tipo de moneda escogido?',
    botonera: 3, // Sí/No
    fnretorno: 'fnMonedaConfirm',
    objeto: { moneda: moneda }
  });
});

// ====== Callbacks globales requeridos por el componente ======
function fnRetornoImprimir(resp) {
  if (resp === 'I') { window.print(); }
  MSGBOX.ventana.HideInfo();
}

function fnMonedaConfirm(resp) {
  if (resp === 'S') {
    let moneda = MSGBOX.ventana.objeto.moneda || '';
    MSGBOX.Abrir({
      titulocss: 'titulonaranjamsgbox',
      titulo: 'Moneda',
      texto: 'La moneda escogida es ' + moneda,
      botonera: 1 // Aceptar
    });
  }
  MSGBOX.ventana.HideInfo();
}
