(function () {
  // Corre dentro del iframe (selector)
  let BD = new BASE();
  BD.commandFile = 'command.php'; // estándar Desis

  function cargarBancos() {
    const RS = BD.send('cmd=listar');
    if (!RS) { alert('No llegó RS desde database/class.php'); return; }
    if (RS.error && String(RS.error).trim() !== '') { alert('Error DB:\n' + RS.error); return; }

    const n  = parseInt(RS.numrows, 10) || 0;
    const sel = document.getElementById('selBanco');
    sel.innerHTML = '';

    let opt0 = document.createElement('option');
    opt0.value = '';
    opt0.text  = 'Seleccione...';
    sel.appendChild(opt0);

    for (let i = 0; i < n; i++) {
      let id  = BD.getField(RS, 'idbanco', i);
      let nom = BD.getField(RS, 'nombre',  i) || '';
      if (!nom) continue;
      let op = document.createElement('option');
      op.value = id;
      op.text  = nom;
      sel.appendChild(op);
    }
  }

  // Abre el segundo lightbox (solo muestra el nombre del banco)
  function abrirLBDetalle(nombre) {
    const L = new IU();
    L.ShowInfoWidget('lb_detalle.php?nombre=' + encodeURIComponent(nombre), 420, 700, 'CerrarLBInterno', 80);
    // expone cierre para el [X] del componente
    window.CerrarLBInterno = function(){ L.HideInfo(); };
  }

  function irAPagina() {
    const sel = document.getElementById('selBanco');
    const id  = sel.value;
    const nom = sel.options[sel.selectedIndex] ? sel.options[sel.selectedIndex].text : '';

    if (String(id).trim() === '') {
      // mostrar sobre el overlay del lightbox
      try {
        top.MSGBOX.Abrir({
          titulocss: 'titulorojomsgbox',
          titulo: 'Advertencia',
          texto: 'Debe seleccionar un banco, para abrir el lightbox.',
          botonera: 1,
          fnretorno: 'top.retMsgOnlyClose',
          conCerrar: true,
          zzIndex: 9000
        });
      } catch (e) { alert('Debe seleccionar un banco.'); }
      return;
    }

    abrirLBDetalle(nom);
  }

  document.addEventListener('DOMContentLoaded', function () {
    cargarBancos();
    const btn = document.getElementById('btnGo');
    if (btn) btn.onclick = irAPagina;
  });
})();
