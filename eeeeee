<?php
while (!file_exists($POSICION.'conexion.php')) { $POSICION .= '../'; }
require_once $POSICION.'conexion.php';

$cmd = $_REQUEST['cmd'] ?? '';

switch ($cmd) {
  case 'listar': {
    $query = "
      SELECT
        idpersona,
        COALESCE(nombre,'')     AS nombre,
        COALESCE(apellidos,'')  AS apellidos,
        TO_CHAR(fechahora,'YYYY-MM-DD HH24:MI') AS fechahora
      FROM personal.persona
      WHERE activo = true
      ORDER BY idpersona DESC
      LIMIT 50
    ";
  } break;

  case 'eliminar': {
    $id = isset($_REQUEST['idpersona']) ? (int) $_REQUEST['idpersona'] : 0;
    if ($id <= 0) { die('Parametro invalido'); }
    $query = "
      UPDATE personal.persona
         SET activo = false
       WHERE idpersona = {$id}
       RETURNING idpersona
    ";
  } break;

  default:
    die('Comando no valido');
}
