<?php
// Resolver ruta base DESIS
while (!file_exists($POSICION."conexion.php")) { $POSICION .= "../"; }
require($POSICION."formHeader.php");
?>
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>MyIFrame – Cliente/Proveedor</title>

  <link rel="stylesheet" href="<?=$POSICION?>css/nuevoestilo.css?v=1.8">

  <style>
    .contenedor{ max-width:900px; margin:auto; background:#f1f1f1; }
    .fila{ padding:10px 12px; }
    .inline{ display:inline-flex; align-items:center; gap:6px; }
    .btn{ height:26px; padding:0 10px; border-radius:6px; border:1px solid #6c757d; background:#e9ecef; cursor:pointer; }
  </style>
</head>
<body>

<div class="FORMULARIONECSS contenedor">
  <!-- BLOQUE DE BÚSQUEDA -->
  <fieldset>
    <legend class="legends">Búsqueda</legend>
    <div class="fila">
      <label for="rut">RUT</label>
      <div class="inline">
        <input type="text" id="rut" placeholder="12.345.678-9" maxlength="20" style="width:320px;">
        <!-- Aquí pinta la LUPA el componente -->
        <div id="divBuscador" style="display:inline"></div>
        <!-- Botón limpiar manual -->
        <button type="button" id="btnLimpiar" class="btn">Limpiar</button>
      </div>
      <!-- Si necesitas capturar el id del cliente/proveedor -->
      <input type="hidden" id="idclienteproveedor">
    </div>
  </fieldset>

  <!-- BLOQUE DE FRAMES -->
  <fieldset>
    <legend class="legends">Cliente / Proveedor</legend>
    <div id="hostFrames"></div>
  </fieldset>
</div>

<!-- Dependencias del sistema -->
<script src="<?=$POSICION?>js/general.js"></script> <!-- MyIFrame -->
<script src="<?=$POSICION?>componente/database/class.php"></script>
<script src="<?=$POSICION?>js/util.js"></script>
<script src="<?=$POSICION?>componente/buscadores/clienteproveedor2/class.js"></script>
<script src="<?=$POSICION?>componente/mascara/lightbox-iframe.js"></script>
<script src="<?=$POSICION?>componente/mascara/iu.js"></script>

<script>
/* ===================== 1) MyIFrame: Cliente/Proveedor ===================== */
(function(){
  // Ruta a clienteproveedor.php (misma carpeta)
  var url_cp = "clienteproveedor.php";

  // Directorio de íconos del frame
  var imgdir = '<?=$POSICION."img/".$CSS_STYLE."/rows/";?>';

  // Crear frame
  window.frame_cp = new MyIFrame('frame_cp','CLIENTE / PROVEEDOR','', imgdir);
  frame_cp.height = 180;           // alto aproximado como en tu captura
  frame_cp.src    = url_cp;        // carga el formulario
  frame_cp.show(true);             // dibuja
  // frame_cp.contract();          // si quieres que parta contraído, descomenta

  // Insertarlo en el contenedor
  document.getElementById('hostFrames').appendChild(document.getElementById('frame_cp'));
})();

/* ============== 2) Buscador ClienteProveedor2 pegado al input RUT ============== */
const cp2 = new ClienteProveedor2();

// Dónde se renderiza la LUPA
cp2.ubicacion = document.getElementById('divBuscador');

// Solo LUPA (los otros botones los controlas tú)
cp2.creaBotonBuscar = true;
cp2.creaBotonBorrar = false;
cp2.creaBotonCrear  = false;

// Campo que recibe onkeypress
cp2.elementoBuscador = 'rut';

// Lightbox + tamaño + filtros
cp2.islightbox    = true;
cp2.altoLightbox  = 500;
cp2.anchoLightbox = 800;
cp2.filtro        = 'cliente|vigente|puedefacturar';
cp2.tituloGrilla  = 'Clientes vigentes facturando';

// Elementos a rellenar por ahora (rut + id)
cp2.elementos = {
  rut: document.getElementById('rut'),
  idclienteproveedor: document.getElementById('idclienteproveedor')
};

// Inicializar componente
cp2.New();

// Botón "Limpiar"
document.getElementById('btnLimpiar').addEventListener('click', function(){
  document.getElementById('rut').value = '';
  document.getElementById('idclienteproveedor').value = '';
});

</script>

<?php require($POSICION."formFoot.php"); ?>
</body>
</html>
