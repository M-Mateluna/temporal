// controlador.js â€” MessageBox (Desis) completo
// Requiere que index.php defina:  <script>var posicion = "<?=$POSICION?>";</script>
// y cargue el componente:        <script src="<?=$POSICION?>componente/messagebox/class.php?v=1"></script>

let MSGBOX = {
  ventana: undefined,

  initialize: function () {
    this.ventana = new IU_MSGBOX();
  },

  Abrir: function (conf) {
    // TÃ­tulo y texto centrado
    this.ventana.titulo = conf.titulo || 'Aviso';
    let texto = conf.texto || '';
    this.ventana.texto = '<center>' + texto + '</center>';

    // Botonera:
    // 1: Aceptar | 2: Aceptar/Cancelar | 3: SÃ­/No | 4: SÃ­/No/Cancelar | 5: Imprimir/Cancelar | 6: Aceptar/Cancelar/Anular
    this.ventana.botonera = (conf.botonera != null) ? conf.botonera : 1;

    // Opcionales igual al patrÃ³n corporativo
    this.ventana.conCerrar = (conf.conCerrar != undefined) ? conf.conCerrar : this.ventana.conCerrar;
    this.ventana.fnretorno = conf.fnretorno || 'retGenerico';
    if (conf.titulocss) this.ventana.titulocss = conf.titulocss;

    // ðŸ”‘ Base del sistema (desde index.php)
    this.ventana.url = (typeof posicion !== 'undefined') ? posicion : '';

    this.ventana.top    = conf.top || '25%';
    this.ventana.objeto = conf.objeto || {};

    // Abrir
    this.ventana.Messagebox();
    this.ventana.zzIndex = 2;
  }
};

MSGBOX.initialize();

/* =========================
   Botones del ejercicio
   ========================= */
let btnSoloAceptar            = document.getElementById('btnSoloAceptar');
let btnAceptarCancelar        = document.getElementById('btnAceptarCancelar');
let btnSiNo                   = document.getElementById('btnSiNo');
let btnSiNoCancelar           = document.getElementById('btnSiNoCancelar');
let btnImprimirCancelar       = document.getElementById('btnImprimirCancelar');
let btnAceptarCancelarAnular  = document.getElementById('btnAceptarCancelarAnular');
let selMoneda                 = document.getElementById('selMoneda');

// 1) Solo Aceptar
if (btnSoloAceptar) {
  btnSoloAceptar.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'InformaciÃ³n',
      texto: 'Este MessageBox solo muestra el botÃ³n Aceptar.',
      botonera: 1,
      titulocss: 'titulorojomsgbox',
      fnretorno: 'retGenerico',
      conCerrar: false
    });
  });
}

// 2) Aceptar / Cancelar
if (btnAceptarCancelar) {
  btnAceptarCancelar.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'ConfirmaciÃ³n',
      texto: 'Â¿Desea continuar con la acciÃ³n?',
      botonera: 2,
      titulocss: 'titulonaranjamsgbox',
      fnretorno: 'retGenerico'
    });
  });
}

// 3) SÃ­ / No
if (btnSiNo) {
  btnSiNo.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'Pregunta',
      texto: 'Â¿Confirma su selecciÃ³n?',
      botonera: 3,
      titulocss: 'titulorojomsgbox',
      fnretorno: 'retGenerico'
    });
  });
}

// 4) SÃ­ / No / Cancelar
if (btnSiNoCancelar) {
  btnSiNoCancelar.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'Guardar cambios',
      texto: 'Â¿Deseas guardar antes de salir?',
      botonera: 4,
      titulocss: 'titulonaranjamsgbox',
      fnretorno: 'retGenerico'
    });
  });
}

// 5) Imprimir / Cancelar  (retorna 'I' o 'C')
if (btnImprimirCancelar) {
  btnImprimirCancelar.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'ImpresiÃ³n',
      texto: 'Â¿Desea imprimir el documento actual?',
      botonera: 5,
      titulocss: 'titulorojomsgbox',
      fnretorno: 'retImprimir'
    });
  });
}

// 6) Aceptar / Cancelar / Anular
if (btnAceptarCancelarAnular) {
  btnAceptarCancelarAnular.addEventListener('click', function () {
    MSGBOX.Abrir({
      titulo: 'Estado de operaciÃ³n',
      texto: 'Selecciona el estado de la operaciÃ³n.',
      botonera: 6,
      titulocss: 'titulonaranjamsgbox',
      fnretorno: 'retGenerico'
    });
  });
}

/* =========================
   Select de moneda
   ========================= */
if (selMoneda) {
  selMoneda.addEventListener('change', function () {
    let moneda = selMoneda.value;
    if (moneda === '') return;

    // Primer cuadro: SÃ­/No
    MSGBOX.Abrir({
      titulocss: 'titulorojomsgbox',
      titulo: 'Moneda',
      texto: '&#191;Desea mostrar el tipo de moneda escogido?',
      botonera: 3,                 // SÃ­/No
      conCerrar: false,
      fnretorno: 'retMonedaConfirm',
      objeto: { moneda: moneda }
    });
  });
}

/* =========================
   Callbacks globales
   ========================= */

// GenÃ©rico: cierra sin acciones adicionales
function retGenerico(resp) {
  // resp podrÃ­a ser 'A','C','S','N','I','L' segÃºn la botonera
  MSGBOX.ventana.HideInfo();
}

// Imprimir/Cancelar
function retImprimir(resp) {
  if (resp === 'I') {
    window.print();
  }
  MSGBOX.ventana.HideInfo();
}

// Flujo de moneda: SÃ­ => muestra moneda; No => solo cierra
function retMonedaConfirm(resp) {
  if (resp === 'S') {
    let moneda = MSGBOX.ventana.objeto.moneda || '';
    MSGBOX.Abrir({
      titulocss: 'titulonaranjamsgbox',
      titulo: 'Moneda',
      texto: 'La moneda escogida es ' + moneda,
      botonera: 1, // Aceptar
      fnretorno: 'retGenerico',
      conCerrar: true
    });
  }
  MSGBOX.ventana.HideInfo();
}
